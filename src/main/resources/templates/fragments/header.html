<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="header">
    <header class="desktop-header">
        <a th:href="${session.user != null ? (session.user.role == 'admin' || session.user.role == 'ROLE_ADMIN' ? '/admin/dashboard' : '/user/dashboard') : '/login'}" class="logo">
            Finance<span style="color: var(--accent);">All.</span> ğŸš€
        </a>
        
        <nav class="nav-menu">
            <div th:if="${session.user != null && (session.user.role == 'user' || session.user.role == 'ROLE_USER')}" class="d-flex gap-3 align-items-center">
                <a th:href="@{/user/dashboard}" class="nav-link">ğŸ“Š Dashboard</a>
                <a th:href="@{/user/transaction}" class="nav-link">ğŸ’¸ Transaksi</a>
                <a th:href="@{/user/wallet}" class="nav-link">ğŸ‘› Dompet</a>
                <a th:href="@{/user/debt}" class="nav-link">ğŸ“‘ Hutang</a>
                <a th:href="@{/user/emergency}" class="nav-link">ğŸ›¡ï¸ Dana Darurat</a>
                <a th:href="@{/user/fi}" class="nav-link">ğŸ§® Kalkulator FI</a>
            </div>

            <div th:if="${session.user != null && (session.user.role == 'admin' || session.user.role == 'ROLE_ADMIN')}" class="d-flex gap-3 align-items-center">
                <a th:href="@{/admin/dashboard}" class="nav-link">ğŸ  Dashboard</a>
                <a th:href="@{/admin/analysis}" class="nav-link">ğŸ“ˆ Analisis</a>
                <a th:href="@{/admin/users}" class="nav-link">ğŸ‘¥ Pengguna</a>
                <a th:href="@{/admin/logs}" class="nav-link">ğŸ“œ Log Aktivitas</a>
            </div>
            
            <div class="d-flex align-items-center gap-3 ms-4 ps-4 border-start border-secondary border-opacity-25">
                <a th:href="@{/user/profile}" class="nav-link m-0" 
                   th:if="${session.user != null && (session.user.role == 'user' || session.user.role == 'ROLE_USER')}">
                   ğŸ‘¤ <span class="d-none d-lg-inline">Profil</span>
                </a>

                <button class="theme-btn" onclick="toggleTheme()" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 0;">
                    <span id="theme-icon-desktop">ğŸŒ™</span>
                </button>

                <a th:href="@{/logout}" class="btn btn-sm btn-danger text-white fw-bold px-3 py-2" style="border-radius: 10px; text-decoration: none;">
                    Logout
                </a>
            </div>
        </nav>
    </header>

    <div class="mobile-header">
        <button class="menu-toggle" onclick="toggleMobile()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">â˜°</button>
        <div class="logo">FinanceAll.</div>
        <button class="theme-btn" onclick="toggleTheme()" style="background: none; border: none; cursor: pointer;"><span id="theme-icon-mobile">ğŸŒ™</span></button>
    </div>

    <div class="mobile-sidebar" id="mobileSidebar">
        <div class="p-4">
            <h3 class="fw-bold mb-1" style="color: var(--accent);">Menu</h3>
            <p class="small text-muted mb-4" th:text="${session.user != null ? 'Hi, ' + session.user.username : 'Guest'}"></p>
            
            <div th:if="${session.user != null}">
                <div th:if="${session.user.role == 'user' || session.user.role == 'ROLE_USER'}">
                    <a th:href="@{/user/dashboard}" class="mobile-link">ğŸ“Š Dashboard</a>
                    <a th:href="@{/user/transaction}" class="mobile-link">ğŸ’¸ Transaksi</a>
                    <a th:href="@{/user/wallet}" class="mobile-link">ğŸ‘› Dompet</a>
                    <a th:href="@{/user/debt}" class="mobile-link">ğŸ“‘ Hutang</a>
                    <a th:href="@{/user/emergency}" class="mobile-link">ğŸ›¡ï¸ Dana Darurat</a>
                    <a th:href="@{/user/fi}" class="mobile-link">ğŸ§® Kalkulator FI</a>
                    <a th:href="@{/user/profile}" class="mobile-link">ğŸ‘¤ Profil Saya</a>
                </div>

                <div th:if="${session.user.role == 'admin' || session.user.role == 'ROLE_ADMIN'}">
                    <a th:href="@{/admin/dashboard}" class="mobile-link">ğŸ  Dashboard</a>
                    <a th:href="@{/admin/analysis}" class="mobile-link">ğŸ“ˆ Analisis</a>
                    <a th:href="@{/admin/users}" class="mobile-link">ğŸ‘¥ Pengguna</a>
                    <a th:href="@{/admin/logs}" class="mobile-link">ğŸ“œ Log Aktivitas</a>
                </div>

                <a th:href="@{/logout}" class="mobile-link text-danger mt-3 pt-3 border-top fw-bold">ğŸšª Logout</a>
            </div>
        </div>
    </div>
    <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobile()"></div>

    <script>
        function toggleMobile() { 
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('mobileOverlay');
            sidebar.classList.toggle('active');
            overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
        }
        
        function toggleTheme() {
            const doc = document.documentElement;
            const isDark = doc.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            doc.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateIcons(newTheme);
        }

        function updateIcons(theme) {
            const icon = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            const desktopIcon = document.getElementById('theme-icon-desktop');
            const mobileIcon = document.getElementById('theme-icon-mobile');
            if(desktopIcon) desktopIcon.textContent = icon;
            if(mobileIcon) mobileIcon.textContent = icon;
        }

        // Init theme on load
        if(localStorage.getItem('theme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            updateIcons('dark');
        }
    </script>
</div>
</body>
</html>